generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ACCOUNT__ROLE_ALIAS {
  ADMIN
  USER
  PLOT_OWNER
}

enum USER__GENDER_ALIAS {
  MALE
  FEMALE
  OTHER
}

enum VEHICLE__TYPE_ALIAS {
  MOTORCYCLE
  CAR
  TRUCK
}

enum PARKING_LOT__STATUS_ALIAS {
  ACTIVE
  INACTIVE
  SUSPENDED
  DELETED
}

enum PARKING_SPOT__STATUS_ALIAS {
  AVAILABLE
  OCCUPIED
  RESERVED
  MAINTENANCE
}

enum RESERVATION__STATUS_ALIAS {
  PENDING
  COMPLETED
  EXPIRED
}

enum PARKING_RECORD__STATUS_ALIAS {
  ON_GOING
  COMPLETED
}

enum PAYMENT_RECORD__METHOD_ALIAS {
  CASH
}

model Account {
  id String @id @default(cuid())

  email     String              @unique
  password  String
  role      ACCOUNT__ROLE_ALIAS
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  user         User?
  AccountToken AccountToken[]
}

model AccountToken {
  id String @id @default(cuid())

  token     String
  expiredAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  accountId String
  account   Account @relation(fields: [accountId], references: [id])
}

model User {
  id String @id @default(cuid())

  firstName String
  lastName  String
  adderss   String
  phone     String
  avatarUrl String?
  gender    USER__GENDER_ALIAS
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  vehicles          Vehicle[]
  parkingLotReviews ParkingLotReview[]
  parkingLots       ParkingLot[]
  paymentRecords    PaymentRecord[]
  userNotifications UserNotification[]

  accountId String  @unique
  account   Account @relation(fields: [accountId], references: [id])
}

model UserNotification {
  id String @id @default(cuid())

  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id])
}

model Vehicle {
  id String @id @default(cuid())

  type      VEHICLE__TYPE_ALIAS
  plate     String
  brand     String
  model     String
  color     String
  imageUrls String[]
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  reservations   Reservation[]
  parkingRecords ParkingRecord[]

  ownerId String
  owner   User   @relation(fields: [ownerId], references: [id])
}

model ParkingLot {
  id String @id @default(cuid())

  name      String
  latitude  Float
  longitude Float
  mediaUrls String[]
  status    PARKING_LOT__STATUS_ALIAS
  createdAt DateTime                  @default(now())
  updatedAt DateTime                  @updatedAt

  parkingSpots       ParkingSpot[]
  parkingLotServices ParkingLotService[]
  parkingLotReviews  ParkingLotReview[]

  ownerId String
  owner   User   @relation(fields: [ownerId], references: [id])
}

model ParkingLotReview {
  id String @id @default(cuid())

  rating    Int
  comment   String
  mediaUrls String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parkingLotId String
  parkingLot   ParkingLot @relation(fields: [parkingLotId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])
}

model ParkingLotService {
  id String @id @default(cuid())

  name         String
  description  String
  mediaUrls    String[]
  price        Float
  vehicleTypes VEHICLE__TYPE_ALIAS[]
  createdAt    DateTime              @default(now())
  updatedAt    DateTime              @updatedAt

  parkingLotId String
  parkingLot   ParkingLot @relation(fields: [parkingLotId], references: [id])
}

model ParkingSpot {
  id String @id @default(cuid())

  isAvailable Boolean
  vehicleType VEHICLE__TYPE_ALIAS
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  reservations   Reservation[]
  parkingRecords ParkingRecord[]

  parkingLotId String
  parkingLot   ParkingLot @relation(fields: [parkingLotId], references: [id])
}

model Reservation {
  id String @id @default(cuid())

  checkInAt DateTime
  status    RESERVATION__STATUS_ALIAS
  createdAt DateTime                  @default(now())
  updatedAt DateTime                  @updatedAt

  parkingRecord ParkingRecord?

  parkingSpotId String
  parkingSpot   ParkingSpot @relation(fields: [parkingSpotId], references: [id])

  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
}

model ParkingRecord {
  id String @id @default(cuid())

  checkInAt  DateTime
  checkOutAt DateTime?
  totalPrice Float?
  status     PARKING_RECORD__STATUS_ALIAS
  createdAt  DateTime                     @default(now())
  updatedAt  DateTime                     @updatedAt

  vehicleId String?
  vehicle   Vehicle? @relation(fields: [vehicleId], references: [id])

  parkingSpotId String?
  parkingSpot   ParkingSpot? @relation(fields: [parkingSpotId], references: [id])

  reservationId String?      @unique
  reservation   Reservation? @relation(fields: [reservationId], references: [id])

  paymentRecord PaymentRecord?
}

model PaymentRecord {
  id String @id @default(cuid())

  method    PAYMENT_RECORD__METHOD_ALIAS
  amount    Float
  createdAt DateTime                     @default(now())
  updatedAt DateTime                     @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id])

  parkingRecordId String        @unique
  parkingRecord   ParkingRecord @relation(fields: [parkingRecordId], references: [id])
}
